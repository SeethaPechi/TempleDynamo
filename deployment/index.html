<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tamil Kovil - Complete Temple Management System</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EüèõÔ∏è%3C/text%3E%3C/svg%3E">
<style>
:root {
  --orange-gradient-start: #ff8c42;
  --orange-gradient-end: #ff6b35;
  --green-status: #28a745;
  --green-status-dark: #20c997;
  --white-bg: #ffffff;
  --gray-text: #666;
  --dark-text: #333;
  --light-gray: #f8f9fa;
  --error-red: #dc3545;
  --purple-accent: #6f42c1;
}

* { 
  margin: 0; 
  padding: 0; 
  box-sizing: border-box; 
}

body { 
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; 
  background: linear-gradient(135deg, var(--orange-gradient-start) 0%, var(--orange-gradient-end) 100%); 
  min-height: 100vh; 
  color: var(--dark-text);
  line-height: 1.6;
}

.container { 
  max-width: 1000px; 
  margin: 0 auto; 
  padding: 40px 20px; 
}

.header { 
  text-align: center; 
  color: white; 
  margin-bottom: 40px; 
  padding: 20px 0; 
}

.header-icon {
  font-size: 48px;
  margin-bottom: 10px;
  display: block;
}

.header h1 { 
  font-size: 48px; 
  margin-bottom: 8px; 
  font-weight: 400;
  display: inline-block;
  margin-left: 10px;
}

.header h2 { 
  font-size: 18px; 
  font-weight: 300; 
  opacity: 0.9; 
  margin-top: 5px;
}

.nav { 
  display: flex; 
  justify-content: center; 
  flex-wrap: wrap; 
  gap: 15px; 
  margin: 30px 0; 
}

.nav-btn { 
  background: rgba(255,255,255,0.3); 
  color: white; 
  padding: 12px 25px; 
  border: none; 
  border-radius: 25px; 
  cursor: pointer; 
  transition: all 0.3s ease;
  font-size: 15px;
  font-weight: 400;
  border: 1px solid rgba(255,255,255,0.3);
}

.nav-btn:hover, .nav-btn.active { 
  background: white; 
  color: var(--orange-gradient-end); 
  border: 1px solid white;
}

.content { 
  display: none; 
  animation: fadeIn 0.3s ease; 
}

.content.active { 
  display: block; 
}

@keyframes fadeIn { 
  from { opacity: 0; } 
  to { opacity: 1; } 
}

.card { 
  background: var(--white-bg); 
  border-radius: 12px; 
  padding: 30px; 
  margin: 25px 0; 
  box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
}

.status-card { 
  background: linear-gradient(135deg, var(--green-status) 0%, var(--green-status-dark) 100%); 
  color: white; 
  position: relative;
}

.status-card::before {
  content: "‚úì";
  font-size: 20px;
  font-weight: bold;
  margin-right: 8px;
}

.status-card h3 {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 12px;
}

.status-card p {
  font-size: 14px;
  line-height: 1.5;
  opacity: 0.95;
  margin: 4px 0;
}

.grid { 
  display: grid; 
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
  gap: 20px; 
  margin: 20px 0;
}

.grid-item { 
  background: white; 
  border: 1px solid #e9ecef; 
  border-radius: 12px; 
  padding: 20px; 
  transition: all 0.3s ease;
  border-left: 4px solid var(--primary);
}

.grid-item:hover { 
  transform: translateY(-5px); 
  box-shadow: 0 8px 25px rgba(0,0,0,0.15); 
}

.btn { 
  display: inline-block; 
  background: var(--orange-gradient-end); 
  color: white; 
  padding: 12px 25px; 
  text-decoration: none; 
  border: none; 
  border-radius: 20px; 
  margin: 8px; 
  cursor: pointer; 
  transition: all 0.3s ease;
  font-size: 14px;
  font-weight: 400;
}

.btn:hover { 
  background: var(--orange-gradient-start); 
  transform: translateY(-1px); 
}

.btn-secondary { background: var(--purple-accent); }
.btn-secondary:hover { background: #5a32a3; }
.btn-success { background: var(--green-status); }
.btn-success:hover { background: var(--green-status-dark); }
.btn-info { background: #17a2b8; }
.btn-info:hover { background: #138496; }

.action-buttons {
  margin-top: 25px;
  text-align: left;
}

.stats { 
  display: grid; 
  grid-template-columns: repeat(4, 1fr); 
  gap: 20px; 
  margin: 30px 0;
}

.stat-item { 
  text-align: center; 
  background: transparent; 
  padding: 20px 15px; 
  border-radius: 8px; 
  cursor: pointer;
  transition: transform 0.2s ease;
}

.stat-item:hover { 
  transform: scale(1.05); 
}

.stat-number { 
  font-size: 80px; 
  font-weight: 300; 
  color: var(--orange-gradient-end); 
  display: block;
  margin-bottom: 8px;
  line-height: 1;
}

.stat-label { 
  color: var(--gray-text); 
  font-weight: 400; 
  text-transform: uppercase; 
  font-size: 12px; 
  letter-spacing: 1px;
  margin-top: 5px;
}

.stats-header {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
}

.stats-header h3 {
  font-size: 18px;
  font-weight: 600;
  color: var(--dark-text);
  margin-left: 8px;
}

.form-group { 
  margin: 15px 0; 
}

.form-group label { 
  display: block; 
  margin-bottom: 8px; 
  font-weight: 600; 
  color: #333;
}

.form-control { 
  width: 100%; 
  padding: 12px 15px; 
  border: 2px solid #e9ecef; 
  border-radius: 8px; 
  font-size: 14px;
  transition: all 0.3s ease;
}

.form-control:focus { 
  outline: none; 
  border-color: var(--primary); 
  box-shadow: 0 0 0 3px rgba(255,107,53,0.1);
}

.table { 
  width: 100%; 
  border-collapse: collapse; 
  margin: 20px 0; 
  background: white;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.table th, .table td { 
  padding: 15px 12px; 
  text-align: left; 
  border-bottom: 1px solid #e9ecef; 
}

.table th { 
  background: var(--light); 
  font-weight: 600; 
  color: #333;
  text-transform: uppercase;
  font-size: 0.85rem;
  letter-spacing: 0.5px;
}

.table tbody tr:hover { 
  background: #f8f9fa; 
}

.loading { 
  text-align: center; 
  color: #666; 
  padding: 40px; 
  font-style: italic;
}

.error { 
  color: var(--danger); 
  background: #f8d7da; 
  padding: 15px; 
  border-radius: 8px; 
  margin: 10px 0; 
  border-left: 4px solid var(--danger);
}

.success { 
  color: #155724; 
  background: #d4edda; 
  padding: 15px; 
  border-radius: 8px; 
  margin: 10px 0; 
  border-left: 4px solid var(--success);
}

.badge { 
  display: inline-block; 
  padding: 4px 8px; 
  border-radius: 12px; 
  font-size: 0.75rem; 
  font-weight: 500; 
  text-transform: uppercase; 
  letter-spacing: 0.5px;
}

.badge-primary { background: var(--primary); color: white; }
.badge-secondary { background: var(--secondary); color: white; }
.badge-success { background: var(--success); color: white; }
.badge-warning { background: var(--warning); color: #333; }
.badge-info { background: var(--info); color: white; }

.search-box { 
  position: relative; 
  margin-bottom: 20px; 
}

.search-box input { 
  padding-left: 45px; 
  background: white;
}

.search-box::before { 
  content: "üîç"; 
  position: absolute; 
  left: 15px; 
  top: 50%; 
  transform: translateY(-50%); 
  font-size: 16px;
  z-index: 1;
}

.connection-status {
  position: fixed;
  top: 10px;
  right: 10px;
  padding: 5px 10px;
  border-radius: 15px;
  font-size: 12px;
  font-weight: 500;
  z-index: 1000;
}

.connection-status.online {
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.connection-status.offline {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

@media (max-width: 768px) {
  .container { padding: 20px 15px; }
  .header h1 { font-size: 36px; }
  .nav { flex-direction: column; align-items: center; }
  .nav-btn { width: 100%; max-width: 200px; margin: 5px 0; }
  .stats { grid-template-columns: repeat(2, 1fr); gap: 15px; }
  .stat-number { font-size: 60px; }
  .grid { grid-template-columns: 1fr; }
  .table { font-size: 14px; }
  .table th, .table td { padding: 10px 8px; }
}

@media (max-width: 480px) {
  .stats { grid-template-columns: 1fr; }
  .stat-number { font-size: 50px; }
  .header h1 { font-size: 28px; }
  .header h2 { font-size: 16px; }
}
</style>
</head>
<body>
<div id="connectionStatus" class="connection-status offline">Connecting...</div>

<div class="container">
  <div class="header">
    <div style="display: flex; align-items: center; justify-content: center;">
      <span class="header-icon">üèõÔ∏è</span>
      <h1>Tamil Kovil</h1>
    </div>
    <h2>Complete Temple Management System</h2>
  </div>
  
  <div class="nav">
    <button class="nav-btn active" onclick="showContent('dashboard')">Dashboard</button>
    <button class="nav-btn" onclick="showContent('members')">Members</button>
    <button class="nav-btn" onclick="showContent('temples')">Temples</button>
    <button class="nav-btn" onclick="showContent('register')">Register</button>
    <button class="nav-btn" onclick="showContent('reports')">Reports</button>
  </div>
  
  <!-- Dashboard -->
  <div id="dashboard" class="content active">
    <div class="card status-card">
      <h3>‚úÖ Tamil Kovil System Online</h3>
      <p>Welcome to the comprehensive Tamil Kovil Temple Management System. Your community platform is connected and operational.</p>
      <p><strong>Server Time:</strong> <span id="currentTime"></span></p>
      <p><strong>Database Status:</strong> <span id="dbStatus">Checking...</span></p>
      <p><strong>Last Update:</strong> <span id="lastUpdate">Never</span></p>
    </div>
    
    <div class="card">
      <div class="stats-header">
        <span>üìä</span>
        <h3>Live Community Statistics</h3>
      </div>
      <div class="stats">
        <div class="stat-item" onclick="showContent('members')">
          <span class="stat-number" id="memberCount">0</span>
          <div class="stat-label">Total Members</div>
        </div>
        <div class="stat-item" onclick="showContent('temples')">
          <span class="stat-number" id="templeCount">0</span>
          <div class="stat-label">Temples</div>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="relationshipCount">0</span>
          <div class="stat-label">Relationships</div>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="uptime">100%</span>
          <div class="stat-label">Uptime</div>
        </div>
      </div>
      <div class="action-buttons">
        <button class="btn" onclick="refreshData()">Refresh Statistics</button>
        <button class="btn btn-secondary" onclick="showContent('register')">Add New Member</button>
      </div>
    </div>
  </div>
  
  <!-- Members Section -->
  <div id="members" class="content">
    <div class="card">
      <h3>üë• Community Members</h3>
      <div class="search-box">
        <input type="text" class="form-control" id="searchMembers" placeholder="Search by name, email, phone, or location..." onkeyup="searchMembers()">
      </div>
      <div class="grid">
        <button class="btn btn-primary" onclick="showContent('register')">+ Add New Member</button>
        <button class="btn btn-info" onclick="loadMembers()">üîÑ Refresh List</button>
        <button class="btn btn-secondary" onclick="exportMembers()">üìä Export Data</button>
      </div>
      <div id="membersList">
        <div class="loading">Click "Refresh List" to load community members...</div>
      </div>
    </div>
  </div>
  
  <!-- Temples Section -->
  <div id="temples" class="content">
    <div class="card">
      <h3>üèõÔ∏è Temple Directory</h3>
      <div class="grid">
        <button class="btn btn-primary" onclick="addTemple()">+ Add New Temple</button>
        <button class="btn btn-info" onclick="loadTemples()">üîÑ Refresh List</button>
      </div>
      <div id="templesList">
        <div class="loading">Click "Refresh List" to load temple directory...</div>
      </div>
    </div>
  </div>
  
  <!-- Register Section -->
  <div id="register" class="content">
    <div class="card">
      <h3>üìù New Member Registration</h3>
      <form id="registrationForm" onsubmit="registerMember(event)">
        <div class="grid">
          <div class="form-group">
            <label for="firstName">First Name *</label>
            <input type="text" class="form-control" name="firstName" id="firstName" required>
          </div>
          <div class="form-group">
            <label for="lastName">Last Name *</label>
            <input type="text" class="form-control" name="lastName" id="lastName" required>
          </div>
          <div class="form-group">
            <label for="email">Email Address</label>
            <input type="email" class="form-control" name="email" id="email">
          </div>
          <div class="form-group">
            <label for="phone">Phone Number</label>
            <input type="tel" class="form-control" name="phone" id="phone">
          </div>
          <div class="form-group">
            <label for="city">City</label>
            <input type="text" class="form-control" name="city" id="city">
          </div>
          <div class="form-group">
            <label for="state">State</label>
            <input type="text" class="form-control" name="state" id="state">
          </div>
          <div class="form-group">
            <label for="gender">Gender</label>
            <select class="form-control" name="gender" id="gender">
              <option value="">Select Gender</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
            </select>
          </div>
          <div class="form-group">
            <label for="maritalStatus">Marital Status</label>
            <select class="form-control" name="maritalStatus" id="maritalStatus">
              <option value="">Select Status</option>
              <option value="Single">Single</option>
              <option value="Married">Married</option>
              <option value="Divorced">Divorced</option>
              <option value="Widowed">Widowed</option>
            </select>
          </div>
        </div>
        <div style="margin-top: 20px;">
          <button type="submit" class="btn btn-success">Register Member</button>
          <button type="button" class="btn btn-secondary" onclick="clearForm()">Clear Form</button>
        </div>
      </form>
      <div id="registrationResult"></div>
    </div>
  </div>
  
  <!-- Reports Section -->
  <div id="reports" class="content">
    <div class="card">
      <h3>üìä Community Reports & Analytics</h3>
      <div id="reportStats" class="stats">
        <div class="stat-item">
          <span class="stat-number" id="totalRegistrations">0</span>
          <div class="stat-label">Total Registrations</div>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="activeMembers">0</span>
          <div class="stat-label">Active Members</div>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="templeAssociations">0</span>
          <div class="stat-label">Temple Associations</div>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="systemHealth">100%</span>
          <div class="stat-label">System Health</div>
        </div>
      </div>
      <button class="btn btn-primary" onclick="generateReport()">Generate Report</button>
      <button class="btn btn-secondary" onclick="exportAllData()">Export All Data</button>
      <div id="reportsOutput"></div>
    </div>
  </div>
</div>

<script>
// Application State
let appData = {
  members: [],
  temples: [],
  relationships: [],
  lastUpdate: null,
  isOnline: false
};

// Initialize Application
function initApp() {
  updateCurrentTime();
  setInterval(updateCurrentTime, 30000);
  checkConnection();
  refreshData();
  console.log('Tamil Kovil System initialized');
}

function updateCurrentTime() {
  const now = new Date();
  const timeStr = now.toLocaleString('en-US', {
    weekday: 'long',
    year: 'numeric',
    month: 'long', 
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });
  document.getElementById('currentTime').textContent = timeStr;
}

async function checkConnection() {
  try {
    const response = await fetch('/api/health', { 
      method: 'GET',
      headers: { 'Accept': 'application/json' }
    });
    
    if (response.ok) {
      const healthData = await response.json();
      appData.isOnline = true;
      updateConnectionStatus('online', 'Database Connected');
      document.getElementById('dbStatus').textContent = 'Connected and Operational';
      console.log('Health check passed:', healthData);
    } else {
      throw new Error(`Health check failed: ${response.status}`);
    }
  } catch (error) {
    // Try alternative check with direct API call
    try {
      const membersResponse = await fetch('/api/members');
      if (membersResponse.ok) {
        appData.isOnline = true;
        updateConnectionStatus('online', 'Database Connected');
        document.getElementById('dbStatus').textContent = 'Connected via API';
        console.log('Database accessible via members API');
        return;
      }
    } catch (apiError) {
      console.warn('Direct API check also failed:', apiError);
    }
    
    appData.isOnline = false;
    updateConnectionStatus('offline', 'Database Offline');
    document.getElementById('dbStatus').textContent = 'Connection Error';
    console.warn('Database connection failed:', error.message);
  }
}

function updateConnectionStatus(status, message) {
  const statusElement = document.getElementById('connectionStatus');
  statusElement.className = `connection-status ${status}`;
  statusElement.textContent = message;
}

// Navigation
function showContent(contentId) {
  document.querySelectorAll('.content').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
  
  document.getElementById(contentId).classList.add('active');
  event.target.classList.add('active');
  
  // Auto-load data when switching to sections
  if (contentId === 'members' && appData.members.length === 0) loadMembers();
  if (contentId === 'temples' && appData.temples.length === 0) loadTemples();
}

// Data Loading Functions
async function refreshData() {
  try {
    await checkConnection();
    
    if (appData.isOnline) {
      const [members, temples, relationships] = await Promise.all([
        fetch('/api/members').then(r => r.ok ? r.json() : []).catch(() => []),
        fetch('/api/temples').then(r => r.ok ? r.json() : []).catch(() => []),
        fetch('/api/relationships').then(r => r.ok ? r.json() : []).catch(() => [])
      ]);
      
      appData.members = members;
      appData.temples = temples;
      appData.relationships = relationships;
      appData.lastUpdate = new Date();
      
      document.getElementById('lastUpdate').textContent = appData.lastUpdate.toLocaleTimeString();
      console.log('Data refreshed successfully:', {
        members: members.length,
        temples: temples.length,
        relationships: relationships.length
      });
    }
    
    updateDashboardStats();
    
  } catch (error) {
    console.error('Data refresh error:', error);
    showError('Unable to refresh data from database', 'dashboard');
  }
}

function updateDashboardStats() {
  document.getElementById('memberCount').textContent = appData.members.length;
  document.getElementById('templeCount').textContent = appData.temples.length;
  document.getElementById('relationshipCount').textContent = appData.relationships.length;
  
  // Update report stats if visible
  if (document.getElementById('totalRegistrations')) {
    document.getElementById('totalRegistrations').textContent = appData.members.length;
    document.getElementById('activeMembers').textContent = appData.members.length;
    document.getElementById('templeAssociations').textContent = appData.temples.length;
  }
}

// Member Management
async function loadMembers() {
  document.getElementById('membersList').innerHTML = '<div class="loading">Loading community members from database...</div>';
  
  try {
    const response = await fetch('/api/members');
    if (response.ok) {
      appData.members = await response.json();
      displayMembers(appData.members);
      updateDashboardStats();
    } else {
      throw new Error(`HTTP ${response.status}`);
    }
  } catch (error) {
    document.getElementById('membersList').innerHTML = `<div class="error">Unable to load members: ${error.message}</div>`;
  }
}

function displayMembers(members) {
  if (members.length === 0) {
    document.getElementById('membersList').innerHTML = 
      '<div class="loading">No members found in database. <button class="btn btn-primary" onclick="showContent(\'register\')">Register the first member</button></div>';
    return;
  }
  
  const html = `
    <table class="table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Contact</th>
          <th>Location</th>
          <th>Details</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${members.map(member => `
          <tr>
            <td>
              <strong>${member.firstName || member.fullName || 'Unknown'} ${member.lastName || ''}</strong>
              ${member.gender ? `<br><span class="badge badge-${member.gender === 'Male' ? 'info' : 'warning'}">${member.gender}</span>` : ''}
            </td>
            <td>
              ${member.email ? `üìß ${member.email}<br>` : ''}
              ${member.phone ? `üìû ${member.phone}` : 'No contact info'}
            </td>
            <td>${[member.city, member.state].filter(Boolean).join(', ') || 'Not provided'}</td>
            <td>
              ${member.maritalStatus ? `<span class="badge badge-secondary">${member.maritalStatus}</span><br>` : ''}
              ${member.templeName ? `<span class="badge badge-primary">Temple: ${member.templeName}</span>` : ''}
            </td>
            <td>
              <button class="btn btn-sm" onclick="viewMember(${member.id})">View</button>
              <button class="btn btn-sm btn-secondary" onclick="editMember(${member.id})">Edit</button>
            </td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
  
  document.getElementById('membersList').innerHTML = html;
}

function searchMembers() {
  const query = document.getElementById('searchMembers').value.toLowerCase();
  if (!query) {
    displayMembers(appData.members);
    return;
  }
  
  const filtered = appData.members.filter(member => {
    const searchText = [
      member.firstName || '',
      member.lastName || '',
      member.fullName || '',
      member.email || '',
      member.phone || '',
      member.city || '',
      member.state || ''
    ].join(' ').toLowerCase();
    
    return searchText.includes(query);
  });
  
  displayMembers(filtered);
}

// Temple Management
async function loadTemples() {
  document.getElementById('templesList').innerHTML = '<div class="loading">Loading temple directory from database...</div>';
  
  try {
    const response = await fetch('/api/temples');
    if (response.ok) {
      appData.temples = await response.json();
      displayTemples(appData.temples);
      updateDashboardStats();
    } else {
      throw new Error(`HTTP ${response.status}`);
    }
  } catch (error) {
    document.getElementById('templesList').innerHTML = `<div class="error">Unable to load temples: ${error.message}</div>`;
  }
}

function displayTemples(temples) {
  if (temples.length === 0) {
    document.getElementById('templesList').innerHTML = 
      '<div class="loading">No temples registered in database. <button class="btn btn-primary" onclick="addTemple()">Add the first temple</button></div>';
    return;
  }
  
  const html = temples.map(temple => `
    <div class="grid-item">
      <h4>${temple.name || temple.templeName}</h4>
      <p><strong>Deity:</strong> ${temple.deity || 'Not specified'}</p>
      <p><strong>Location:</strong> ${temple.location || [temple.city, temple.state].filter(Boolean).join(', ') || 'Not provided'}</p>
      <p><strong>Established:</strong> ${temple.established || temple.foundedYear || 'Unknown'}</p>
      ${temple.description ? `<p>${temple.description}</p>` : ''}
      <button class="btn btn-sm btn-primary" onclick="viewTemple(${temple.id})">View Details</button>
      <button class="btn btn-sm btn-secondary" onclick="editTemple(${temple.id})">Edit</button>
    </div>
  `).join('');
  
  document.getElementById('templesList').innerHTML = `<div class="grid">${html}</div>`;
}

// Registration
async function registerMember(event) {
  event.preventDefault();
  
  const formData = new FormData(event.target);
  const memberData = Object.fromEntries(formData.entries());
  
  // Remove empty fields
  Object.keys(memberData).forEach(key => {
    if (!memberData[key]) delete memberData[key];
  });
  
  try {
    const response = await fetch('/api/members', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(memberData)
    });
    
    if (response.ok) {
      const result = await response.json();
      showSuccess(`‚úÖ ${memberData.firstName} ${memberData.lastName} registered successfully!`, 'registrationResult');
      clearForm();
      
      // Refresh data
      await refreshData();
      
      // Update member list if currently viewing
      if (document.getElementById('members').classList.contains('active')) {
        await loadMembers();
      }
    } else {
      const error = await response.text();
      throw new Error(error || 'Registration failed');
    }
  } catch (error) {
    showError(`Registration failed: ${error.message}`, 'registrationResult');
  }
}

function clearForm() {
  document.getElementById('registrationForm').reset();
  document.getElementById('registrationResult').innerHTML = '';
}

// Utility Functions
function showSuccess(message, elementId) {
  document.getElementById(elementId).innerHTML = `<div class="success">${message}</div>`;
  setTimeout(() => {
    document.getElementById(elementId).innerHTML = '';
  }, 5000);
}

function showError(message, elementId) {
  document.getElementById(elementId).innerHTML = `<div class="error">${message}</div>`;
}

// Feature functions
function viewMember(id) { 
  const member = appData.members.find(m => m.id === id);
  if (member) {
    const details = [
      `Name: ${member.firstName || member.fullName} ${member.lastName || ''}`,
      `Email: ${member.email || 'Not provided'}`,
      `Phone: ${member.phone || 'Not provided'}`,
      `Location: ${[member.city, member.state].filter(Boolean).join(', ') || 'Not provided'}`,
      `Gender: ${member.gender || 'Not specified'}`,
      `Marital Status: ${member.maritalStatus || 'Not specified'}`
    ].join('\n');
    alert(`Member Details:\n\n${details}`);
  }
}

function editMember(id) { alert(`Edit member ${id} - Feature coming soon!`); }
function viewTemple(id) { alert(`View temple ${id} - Feature coming soon!`); }
function editTemple(id) { alert(`Edit temple ${id} - Feature coming soon!`); }
function addTemple() { alert('Add temple form - Feature coming soon!'); }
function exportMembers() { alert('Export functionality - Feature coming soon!'); }
function generateReport() { 
  document.getElementById('reportsOutput').innerHTML = `
    <div class="success">
      <h4>Community Report Generated</h4>
      <p><strong>Total Members:</strong> ${appData.members.length}</p>
      <p><strong>Total Temples:</strong> ${appData.temples.length}</p>
      <p><strong>Database Status:</strong> ${appData.isOnline ? 'Connected' : 'Offline'}</p>
      <p><strong>Last Updated:</strong> ${appData.lastUpdate ? appData.lastUpdate.toLocaleString() : 'Never'}</p>
    </div>
  `;
}
function exportAllData() { alert('Export all data - Feature coming soon!'); }

// Initialize app when page loads
document.addEventListener('DOMContentLoaded', initApp);

// Auto-refresh data every 2 minutes
setInterval(refreshData, 120000);
</script>
</body>
</html>